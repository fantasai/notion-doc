
\chapter{Scripting}
\label{chap:tricks}

This chapter documents some additional features of the Ion configuration
and scripting interface that can be used for more advanced scripting than
the basic configuration exlained in chapter \ref{chap:config}.

\section{Hooks and other callbacks}

\subsection{Hooks}

Hooks are lists of functions to be called when a certain event occurs.
Hook handlers are registered with the function \fnref{add_to_hook}
and removed with \fnref{remove_from_hook}. Both of these functions
take as argument the name of the hook (a string) and the handler,
the parameters of which depend on the actual hook in question.

The following hooks are currently defined:

\begin{tabularx}{\linewidth}{lX}
\hline
Hook & Description \\
\hline
\code{screen_workspace_switched} &
	Called when the object (not necessarily a workspace despite the
	name) viewed on a screen is switched. Parameters to handler:
	the screen and the newly switched-to region. \\
\code{genframe_managed_switched} &
	Called when the region viewed in a frame is switched. Parameters
	to handler: the frame and the newly switched-to region. \\
\code{genframe_activated} &
	Called when a \type{WGenFrame} has received the focus. \\
\code{genframe_inactivated} &
	Called when a \type{WGenFrame} has lost the focus. \\
\code{clientwin_added} &
	Called when a client window has been mapped by a client program
	and Ion has started managing it. \\
\code{deinit} &
	Called when Ion is about to start deinitialising before exiting.
	Handler has no parameters. \\
\end{tabularx}

More hooks can be added on request as need arises.

\subsection{Placement methods}

In addition to the hooks mentioned above there is (at the moment) 
one callback that is not a hook. It is the function
\code{ionws_placement_method} can be used by scripts to decide
in which frame a newly mapped client window should be placed 
within an already decided on \type{WIonWS}. The function has
three parameters: the workspace, the client window and a boolean
indicating whether the client window's geometry (see
\fnref{WRegion.geom}) was specified by the user by e.g. a
\code{-geometry} command line switch. The function should
return a frame on the workspace or \code{nil} if it made no
decision. For example. the window placement heuristics in 
\file{heuristics.lua} implement this function.

\section{Referring to regions}

\subsection{Direct object references}

All Ion objects are passed to Lua scriptss as 'userdatas', and you may
safely store such object references for future use. The C-side object
may be destroyed while Lua still refers to the object. All exported
functions gracefully fail in such a case, but if you need to explicitly
test that the C-side object still exists, use \fnref{obj_exists}.

As an example, the following short piece of code implements 
bookmarking:

\begin{verbatim}
local bookmarks={}

-- Set bookmark bm point to the region reg
function set_bookmark(bm, reg)
    bookmarks[bm]=reg
end

-- Go to bookmark bm
function goto_bookmark(bm)
    if bookmarks[bm] then
        -- We could check that bookmarks[bm] still exists, if we
        -- wanted to avoid an error message.
        bookmarks[bm]:goto()
    end
end
\end{verbatim}

\subsection{Name-based lookups}

If you want to a single region with an exact known name, use
\fnref{lookup_region}. If you want e.g. a list of all regions,
use \fnref{complete_region}\code{("")}. Both functions accept an
optional argument that can be used to specify that the return region(s)
must be of a more specific type. The convenience functions
\fnref{lookup_clientwin}, \fnref{lookup_workspace},
\fnref{complete_clientwin} and \fnref{complete_workspace} are also
provided.

To get the name of an object, use \fnref{WRegion.name}. Please be
aware, that the names of client windows reflect their titles and
are subject to changes. To change the name of a non-client window
region, use \fnref{WRegion.set_name}.


%\section{Alternative winprop selection criteria}

%Ion calls the Lua function \code{get_winprop} to find a winprop
%table for a window. Thus, to select winprops by some alternative
%criterion, simply redefine this function. 

%\section{Sample scripts}
%\fname{heuristics.lua}
%\fname{closeorkill.lua}



